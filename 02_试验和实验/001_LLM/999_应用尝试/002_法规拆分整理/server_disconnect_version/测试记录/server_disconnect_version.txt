/Users/krix/miniconda3/bin/python /Users/krix/PycharmProjects/DailyLearning/02_试验和实验/001_LLM/999_应用尝试/002_法规拆分整理/structure_policy.py
请输入你的API Key：
文件「output/中华人民共和国民法典_test_1_1.pdf」已转换为Markdown格式，并保存到：output/中华人民共和国民法典_test_1_1.md
文件「output/中华人民共和国民法典_test_1_2.pdf」已转换为Markdown格式，并保存到：output/中华人民共和国民法典_test_1_2.md
文件「output/中华人民共和国民法典_test_1_3.pdf」已转换为Markdown格式，并保存到：output/中华人民共和国民法典_test_1_3.md
文件「output/中华人民共和国民法典_test_1_4.pdf」已转换为Markdown格式，并保存到：output/中华人民共和国民法典_test_1_4.md
文件「output/中华人民共和国民法典_test_1_5.pdf」已转换为Markdown格式，并保存到：output/中华人民共和国民法典_test_1_5.md
文件「output/中华人民共和国民法典_test_1_6.pdf」已转换为Markdown格式，并保存到：output/中华人民共和国民法典_test_1_6.md
文件「output/中华人民共和国民法典_test_1_7.pdf」已转换为Markdown格式，并保存到：output/中华人民共和国民法典_test_1_7.md
文件「output/中华人民共和国民法典_test_1_8.pdf」已转换为Markdown格式，并保存到：output/中华人民共和国民法典_test_1_8.md
文件「output/中华人民共和国民法典_test_1_9.pdf」已转换为Markdown格式，并保存到：output/中华人民共和国民法典_test_1_9.md
Sending Query...
estimated_tokens: 6617
Sending Query...
estimated_tokens: 7761
[{'prompt_tokens': 1490, 'completion_tokens': 3606, 'total_tokens': 5096}]
Sending Query...
estimated_tokens: 6597
{'data': [{'编': '', '章': '第四章', '条': '第一百零二条', '款': '', 'content': '非法人组织是不具有法人资格，但是能够依法以自己的名义从事民事活动的组织。 非法人组织包括个人独资企业、合伙企业、不具有法人资格的专业服务机构等。'}, {'编': '', '章': '第四章', '条': '第一百零三条', '款': '', 'content': '非法人组织应当依照法律的规定登记。设立非法人组织，法律、行政法规规定须经有关机关批准的，依照其规定。'}, {'编': '', '章': '第四章', '条': '第一百零四条', '款': '', 'content': '非法人组织的财产不足以清偿债务的，其出资人或者设立人承担无限责任。法律另有规定的，依照其规定。'}, {'编': '', '章': '第四章', '条': '第一百零五条', '款': '', 'content': '非法人组织可以确定一人或者数人代表该组织从事民事活动。'}, {'编': '', '章': '第四章', '条': '第一百零六条', '款': '', 'content': '有下列情形之一的，非法人组织解散：\n- （一）章程规定的存续期间届满或者章程规定的其他解散事由出现；\n- （二）出资人或者设立人决定解散；\n- （三）法律规定的其他情形。'}, {'编': '', '章': '第四章', '条': '第一百零七条', '款': '', 'content': '非法人组织解散的，应当依法进行清算。'}, {'编': '', '章': '第四章', '条': '第一百零八条', '款': '', 'content': '非法人组织除适用本章规定外，参照适用本编第三章第一节的有关规定。'}, {'编': '', '章': '第五章', '条': '第一百零九条', '款': '', 'content': '自然人的人身自由、人格尊严受法律保护。'}, {'编': '', '章': '第五章', '条': '第一百一十条', '款': '', 'content': '自然人享有生命权、身体权、健康权、姓名权、肖像权、名誉权、荣誉权、隐私权、婚姻自主权等权利。法人、非法人组织享有名称权、名誉权和荣誉权。'}, {'编': '', '章': '第五章', '条': '第一百一十一条', '款': '', 'content': '自然人的个人信息受法律保护。任何组织或者个人需要获取他人个人信息的，应当依法取得并确保信息安全，不得非法收集、使用、加工、传输他人个人信息，不得非法买卖、提供或者公开他人个人信息。'}, {'编': '', '章': '第五章', '条': '第一百一十二条', '款': '', 'content': '自然人因婚姻家庭关系等产生的人身权利受法律保护。'}, {'编': '', '章': '第五章', '条': '第一百一十三条', '款': '', 'content': '民事主体的财产权利受法律平等保护。'}, {'编': '', '章': '第五章', '条': '第一百一十四条', '款': '', 'content': '民事主体依法享有物权。物权是权利人依法对特定的物享有直接支配和排他的权利，包括所有权、用益物权和担保物权。'}, {'编': '', '章': '第五章', '条': '第一百一十五条', '款': '', 'content': '物包括不动产和动产。法律规定权利作为物权客体的，依照其规定。'}, {'编': '', '章': '第五章', '条': '第一百一十六条', '款': '', 'content': '物权的种类和内容，由法律规定。'}, {'编': '', '章': '第五章', '条': '第一百一十七条', '款': '', 'content': '为了公共利益的需要，依照法律规定的权限和程序征收、征用不动产或者动产的，应当给予公平、合理的补偿。'}, {'编': '', '章': '第五章', '条': '第一百一十八条', '款': '', 'content': '民事主体依法享有债权。债权是因合同、侵权行为、无因管理、不当得利以及法律的其他规定，权利人请求特定义务人为或者不为一定行为的权利。'}, {'编': '', '章': '第五章', '条': '第一百一十九条', '款': '', 'content': '依法成立的合同，对当事人具有法律约束力。'}, {'编': '', '章': '第五章', '条': '第一百二十条', '款': '', 'content': '民用权益受到侵害的，被侵权人有权请求侵权人承担侵权责任。'}, {'编': '', '章': '第五章', '条': '第一百二十一条', '款': '', 'content': '没有法定的或者约定的义务，为避免他人利益受损失而进行管理的人，有权请求受益人偿还由此支出的必要费用。'}, {'编': '', '章': '第五章', '条': '第一百二十二条', '款': '', 'content': '因他人没有法律根据，取得不当利益，受损失的人有权请求其返还不当利益。'}, {'编': '', '章': '第五章', '条': '第一百二十三条', '款': '', 'content': '民事主体依法享有知识产权。知识产权是权利人依法就下列客体享有的专有的权利：\n- （一）作品；\n- （二）发明、实用新型、外观设计；\n- （三）商标；\n- （四）地理标志；\n- （五）商业秘密；\n- （六）集成电路布图设计；\n- （七）植物新品种；\n- （八）法律规定的其他客体。'}, {'编': '', '章': '第五章', '条': '第一百二十四条', '款': '', 'content': '自然人依法享有继承权。自然人合法的私有财产，可以依法继承。'}, {'编': '', '章': '第五章', '条': '第一百二十五条', '款': '', 'content': '民事主体依法享有股权和其他投资性权利。'}, {'编': '', '章': '第五章', '条': '第一百二十六条', '款': '', 'content': '民事主体享有法律规定的其他民事权利和利益。'}, {'编': '', '章': '第五章', '条': '第一百二十七条', '款': '', 'content': '法律对数据、网络虚拟财产的保护有规定的，依照其规定。'}, {'编': '', '章': '第五章', '条': '第一百二十八条', '款': '', 'content': '法律对未成年人、老年人、残疾人、妇女、消费者等的民事权利保护有特别规定的，依照其规定。'}, {'编': '', '章': '第五章', '条': '第一百二十九条', '款': '', 'content': '民事权利可以依据民事法律行为、事实行为、法律规定的事件或者法律规定的其他方式取得。'}, {'编': '', '章': '第五章', '条': '第一百三十条', '款': '', 'content': '民事主体按照自己的意愿依法行使民事权利，不受干涉。'}, {'编': '', '章': '第五章', '条': '第一百三十一条', '款': '', 'content': '民事主体行使权利时，应当履行法律规定的和当事人约定的义务。'}, {'编': '', '章': '第五章', '条': '第一百三十二条', '款': '', 'content': '民事主体不得滥用民事权利损害国家利益、社会公共利益或者他人合法权益。'}, {'编': '', '章': '第六章', '条': '第一百三十三条', '款': '', 'content': '民事法律行为是民事主体通过意思表示设立、变更、终止民事权利义务关系的行为。'}]}
/Users/krix/miniconda3/lib/python3.13/site-packages/pydantic/main.py:463: UserWarning: Pydantic serializer warnings:
  PydanticSerializationUnexpectedValue(Expected 9 fields but got 6: Expected `Message` - serialized value may not be as expected [input_value=Message(content='\n\n```j...本中的内容。\n'}), input_type=Message])
  PydanticSerializationUnexpectedValue(Expected `StreamingChoices` - serialized value may not be as expected [input_value=Choices(finish_reason='st...ider_specific_fields={}), input_type=Choices])
  return self.__pydantic_serializer__.to_python(

Give Feedback / Get Help: https://github.com/BerriAI/litellm/issues/new
LiteLLM.Info: If you need to debug this error, use `litellm._turn_on_debug()'.

Sending Query...
estimated_tokens: 7547
Traceback (most recent call last):
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/llms/custom_httpx/aiohttp_transport.py", line 55, in map_aiohttp_exceptions
    yield
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/llms/custom_httpx/aiohttp_transport.py", line 206, in handle_async_request
    response = await client_session.request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<12 lines>...
    ).__aenter__()
    ^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/aiohttp/client.py", line 1482, in __aenter__
    self._resp: _RetType = await self._coro
                           ^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/aiohttp/client.py", line 770, in _request
    resp = await handler(req)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/aiohttp/client.py", line 748, in _connect_and_send_request
    await resp.start(conn)
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/aiohttp/client_reqrep.py", line 532, in start
    message, payload = await protocol.read()  # type: ignore[union-attr]
                       ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/aiohttp/streams.py", line 672, in read
    await self._waiter
aiohttp.client_exceptions.ServerDisconnectedError: Server disconnected

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/openai/_base_client.py", line 1519, in request
    response = await self._client.send(
               ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/llms/custom_httpx/aiohttp_transport.py", line 199, in handle_async_request
    with map_aiohttp_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/krix/miniconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/llms/custom_httpx/aiohttp_transport.py", line 69, in map_aiohttp_exceptions
    raise mapped_exc(message) from exc
httpx.ReadError: Server disconnected

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/llms/openai/openai.py", line 801, in acompletion
    headers, response = await self.make_openai_chat_completion_request(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/litellm_core_utils/logging_utils.py", line 135, in async_wrapper
    result = await func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/llms/openai/openai.py", line 436, in make_openai_chat_completion_request
    raise e
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/llms/openai/openai.py", line 418, in make_openai_chat_completion_request
    await openai_aclient.chat.completions.with_raw_response.create(
        **data, timeout=timeout
    )
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/openai/_legacy_response.py", line 381, in wrapped
    return cast(LegacyAPIResponse[R], await func(*args, **kwargs))
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 2454, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
    ...<45 lines>...
    )
    ^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/openai/_base_client.py", line 1784, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/openai/_base_client.py", line 1551, in request
    raise APIConnectionError(request=request) from err
openai.APIConnectionError: Connection error.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/main.py", line 525, in acompletion
    response = await init_response
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/llms/openai/openai.py", line 848, in acompletion
    raise OpenAIError(
    ...<4 lines>...
    )
litellm.llms.openai.common_utils.OpenAIError: Connection error.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/krix/PycharmProjects/DailyLearning/02_试验和实验/001_LLM/999_应用尝试/002_法规拆分整理/structure_policy.py", line 99, in <module>
    analyze(policy_analyzer, pdf_filename, 3, artifacts_path_local)
    ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/PycharmProjects/DailyLearning/02_试验和实验/001_LLM/999_应用尝试/002_法规拆分整理/structure_policy.py", line 74, in analyze
    loop.run_until_complete(async_analyze(llm_client, llm_client.max_concurrent, pdf_filename, interval, artifacts_path_local))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/krix/PycharmProjects/DailyLearning/02_试验和实验/001_LLM/999_应用尝试/002_法规拆分整理/structure_policy.py", line 91, in async_analyze
    response = await completed_task
               ^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/asyncio/tasks.py", line 634, in _wait_for_one
    return f.result() if resolve else f
           ~~~~~~~~^^
  File "/Users/krix/PycharmProjects/DailyLearning/02_试验和实验/001_LLM/999_应用尝试/002_法规拆分整理/structure_policy.py", line 60, in parse
    response_text = await self.client.generate(build_prompt(text))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/PycharmProjects/DailyLearning/02_试验和实验/001_LLM/999_应用尝试/002_法规拆分整理/openai_model.py", line 100, in generate
    completion = await acompletion(**kwargs)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/utils.py", line 1494, in wrapper_async
    raise e
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/utils.py", line 1355, in wrapper_async
    result = await original_function(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/main.py", line 544, in acompletion
    raise exception_type(
          ~~~~~~~~~~~~~~^
        model=model,
        ^^^^^^^^^^^^
    ...<3 lines>...
        extra_kwargs=kwargs,
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/litellm_core_utils/exception_mapping_utils.py", line 2271, in exception_type
    raise e
  File "/Users/krix/miniconda3/lib/python3.13/site-packages/litellm/litellm_core_utils/exception_mapping_utils.py", line 479, in exception_type
    raise InternalServerError(
    ...<5 lines>...
    )
litellm.exceptions.InternalServerError: litellm.InternalServerError: InternalServerError: OpenAIException - Connection error.

Process finished with exit code 139 (interrupted by signal 11:SIGSEGV)
